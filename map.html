<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <!-- âœ… ì¶”ê°€: ë„¤ì´ë²„ ì„œë²„ì— ë„ë©”ì¸ ì •ë³´ë¥¼ ëª…í™•í•˜ê²Œ ì „ë‹¬í•˜ì—¬ ì¸ì¦ ì˜¤ë¥˜ ë°©ì§€ -->
    <meta name="referrer" content="origin">
    <title>Naver Map</title>
    <style>
        /* ì§€ë„ í™”ë©´ ìŠ¤íƒ€ì¼ */
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #f0f0f0; }
        #map { width: 100%; height: 100%; }
        
        /* ì—ëŸ¬ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        .error-msg {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            color: #666;
            font-family: sans-serif;
            font-size: 14px;
            text-align: center;
            padding: 20px;
            line-height: 1.6;
        }
    </style>
</head>
<body>
<!-- ì§€ë„ í‘œì‹œ ì˜ì—­ -->
<div id="map"></div>

<script>
    /**
     * âœ… ìµœì¢… ì™„ì„±ë³¸: URL íŒŒë¼ë¯¸í„° ê¸°ë°˜ ì§€ë„ í‘œì‹œ
     * referrer ë©”íƒ€ íƒœê·¸ ì¶”ê°€ ë° ê³µë°± ì œê±° ë¡œì§ ê°•í™”
     */

    // 1. URL íŒŒë¼ë¯¸í„° ì½ê¸°
    const urlParams = new URLSearchParams(window.location.search);
    const lat = parseFloat(urlParams.get('lat'));
    const lng = parseFloat(urlParams.get('lng'));
    // ê³µë°±ì´ ì„ì—¬ ë“¤ì–´ê°€ëŠ” ê²½ìš°ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ trim() ì¶”ê°€
    const clientIdRaw = urlParams.get('clientId');
    const clientId = clientIdRaw ? clientIdRaw.trim() : null;

    const mapDiv = document.getElementById('map');

    // 2. ìœ íš¨ì„± ê²€ì‚¬
    if (!clientId) {
        mapDiv.innerHTML = 
            "<div class='error-msg'>âš ï¸ <b>ì„¤ì • ì˜¤ë¥˜</b><br>Client IDê°€ URLì— ì—†ìŠµë‹ˆë‹¤.<br>ì£¼ì†Œ ë’¤ì— ?clientId=... ê°€ ìˆëŠ”ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.</div>";
    } 
    else if (isNaN(lat) || isNaN(lng)) {
        // IDëŠ” ìˆì§€ë§Œ ì¢Œí‘œê°€ ì—†ëŠ” ê²½ìš° (ì •ìƒ ì ‘ì†ì´ì§€ë§Œ ìœ„ì¹˜ ë¯¸ì§€ì •)
        mapDiv.innerHTML = 
            "<div class='error-msg'>ğŸ“ <b>ìœ„ì¹˜ ì •ë³´ ëŒ€ê¸° ì¤‘</b><br>Client IDëŠ” í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.<br>ì¢Œí‘œ(?lat=...&lng=...)ê°€ ì…ë ¥ë˜ë©´ ì§€ë„ê°€ í‘œì‹œë©ë‹ˆë‹¤.</div>";
    } 
    else {
        // 3. ë„¤ì´ë²„ ì§€ë„ ìŠ¤í¬ë¦½íŠ¸ 'ë™ì ' ë¡œë“œ
        const script = document.createElement('script');
        script.src = `https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=${clientId}`;
        // script.async = true;
        
        script.onload = () => {
            try {
                var position = new naver.maps.LatLng(lat, lng);
                var map = new naver.maps.Map('map', {
                    center: position,
                    zoom: 16,
                    scaleControl: false,
                    logoControl: false,
                    mapDataControl: false,
                    zoomControl: true,
                    zoomControlOptions: {
                        position: naver.maps.Position.TOP_RIGHT
                    }
                });
                new naver.maps.Marker({ position: position, map: map });
            } catch (e) {
                mapDiv.innerHTML = 
                    "<div class='error-msg'>ğŸš« <b>ì§€ë„ ì‹¤í–‰ ì˜¤ë¥˜</b><br>" + e.message + "</div>";
            }
        };

        script.onerror = () => {
            // ì—ëŸ¬ ë©”ì‹œì§€ ìˆ˜ì •: í˜¼ë€ì„ ì£¼ëŠ” ì„œë¹„ìŠ¤ ëª…ì¹­ì„ ì œê±°í•˜ê³  'Web ì„œë¹„ìŠ¤ URL' ì„¤ì •ì„ ê°•ì¡°
            mapDiv.innerHTML = 
                "<div class='error-msg'>ğŸš« <b>API ë¡œë“œ ì‹¤íŒ¨</b><br>Client IDê°€ í‹€ë ¸ê±°ë‚˜<br>ë„¤ì´ë²„ ì½˜ì†”ì˜ <b>Web ì„œë¹„ìŠ¤ URL</b> ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.<br>(Web Dynamic Mapì´ ì„ íƒë˜ì—ˆëŠ”ì§€ë„ í™•ì¸ í•„ìš”)</div>";
        };

        document.head.appendChild(script);
    }
</script>
</body>
</html>